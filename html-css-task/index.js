const headerMenu = [
    {
        title: "Why Spring",
        dropdown: [
            {
                href: '#',
                text: 'Overview',
            },
            {
                href: '#',
                text: 'Microservices',
            },
            {
                href: '#',
                text: 'Reactive',
            },
            {
                href: '#',
                text: 'Event Driven',
            },
            {
                href: '#',
                text: 'Cloud',
            },
            {
                href: '#',
                text: 'Web Applications',
            },
            {
                href: '#',
                text: 'Serverless',
            },
            {
                href: '#',
                text: 'Batch',
            },
        ],
    },
    {
        title: "Learn",
        dropdown: [
            {
                href: '#',
                text: 'Overview',
            },
            {
                href: '#',
                text: 'Quickstart',
            },
            {
                href: '#',
                text: 'Guides',
            },
            {
                href: '#',
                text: 'Blog',
            },
        ],
    },
    {
        title: "Projects",
        dropdown: [
            {
                href: '#',
                text: 'Overview',
            },
            {
                href: '#',
                text: 'Spring Boot',
            },
            {
                href: '#',
                text: 'Spring Framework',
            },
            {
                href: '#',
                text: 'Spring Cloud',
            },
            {
                href: '#',
                text: 'Spring Cloud Data Flow',
            },
            {
                href: '#',
                text: 'Spring Data',
            },
            {
                href: '#',
                text: 'Spring Integration',
            },
            {
                href: '#',
                text: 'Spring Batch',
            },
            {
                href: '#',
                text: 'Spring Security',
            },
            {
                href: '#',
                text: 'View all projects',
            },

        ],
    },
    {
        title: "Training",
        href: "#",
    },
    {
        title: "Support",
        href: "#",
    },
    {
        title: "Community",
        dropdown: [
            {
                href: '#',
                text: 'Overview',
            },
            {
                href: '#',
                text: 'Events',
            },
            {
                href: '#',
                text: 'Team',
            },

        ],
    },
];
const projects = [
    {
        title: "Spring Boot",
        description: "Takes an opinionated view of building Spring applications and gets you up and running as quickly as possible",
        imageSrc: "assets/images/card-images/spring-boot.svg",
        href: '#',
    },
    {
        title: "Spring Framework",
        description: "Provides core support for dependency injection, transaction management, web apps, data access, messaging, and more.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-framework-2.svg",
    },
    {
        href: '#',
        title: "Spring Data",
        description: "Provides a consistent approach to data access – relational, non-relational, map-reduce, and beyond.",
        imageSrc: "assets/images/card-images/spring-data-3.svg",
    },
    {
        title: "Spring Cloud",
        description: "Provides a set of tools for common patterns in distributed systems. Useful for building and deploying microservices.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-cloud-4.svg",
    },
    {
        title: "Spring Cloud Data Flow",
        description: "Provides an orchestration service for composable data microservice applications on modern runtimes.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-data-flow-5.svg",
    },
    {
        title: "Spring Security",
        description: "Protects your application with comprehensive and extensible authentication and authorization support.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-security-6.svg",
    },
    {
        title: "Spring for GraphQL",
        description: "Spring for GraphQL provides support for Spring applications built on GraphQL Java.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-graphql-7.svg",
    },
    {
        title: "Spring Session",
        description: "Provides an API and implementations for managing a user’s session information.",
        href: '#',
        imageSrc: "assets/images/card-images/logo-session-8.png",
    },
    {
        title: "Spring Integration",
        description: "Supports the well-known Enterprise Integration Patterns through lightweight messaging and declarative adapters.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-integration-9.svg",
    },
    {
        title: "Spring HATEOAS",
        description: "Simplifies creating REST representations that follow the HATEOAS principle.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-hateoas-10.svg",
    },
    {
        title: "Spring REST Docs",
        description: "Lets you document RESTful services by combining hand-written documentation with auto-generated snippets produced with Spring MVC Test or REST Assured.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-restdocs-11.png",
    },
    {
        title: "Spring Batch",
        description: "Simplifies and optimizes the work of processing high-volume batch operations.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-batch-12.svg",
    },
    {
        title: "Spring AMQP",
        description: "Applies core Spring concepts to the development of AMQP-based messaging solutions.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-amqp-13.svg",
    },
    {
        title: "Spring CredHub",
        description: "Provides client-side support for storing, retrieving, and deleting credentials from a CredHub server running in a Cloud Foundry platform.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-14.svg",
    },
    {
        title: "Spring Flo",
        description: "Provides a JavaScript library that offers a basic embeddable HTML5 visual builder for pipelines and simple graphs.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-flo-15.svg",
    },
    {
        title: "Spring for Apache Kafka",
        description: "Provides Familiar Spring Abstractions for Apache Kafka.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-kafka-16.svg",
    },
    {
        title: "Spring LDAP",
        description: "Simplifies the development of applications that use LDAP by using Spring's familiar template-based approach.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-ldap-17.svg",
    },
    {
        title: "Spring Shell",
        description: "Makes writing and testing RESTful applications easier with CLI-based resource discovery and interaction.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-shell-18.svg",
    },
    {
        title: "Spring Statemachine",
        description: "Provides a framework for application developers to use state machine concepts with Spring applications.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-statemachine-19.svg",
    },
    {
        title: "Spring Vault",
        description: "Provides familiar Spring abstractions for HashiCorp Vault",
        href: '#',
        imageSrc: "assets/images/card-images/spring-20.svg",
    },
    {
        title: "Spring Web Flow",
        description: "Supports building web applications that feature controlled navigation, such as checking in for a flight or applying for a loan.",
        href: '#',
        imageSrc: "assets/images/card-images/spring-web-flo-21.svg",
    },
    {
        title: "Spring Web Services",
        description: "Facilitates the development of contract-first SOAP web services.",
        href: '#',
        imageSrc: "assets/images/card-images/logo-web-services-22.svg",
    },
];

const headerBlock = document.querySelector('.menu__list');
const projectBlock = document.querySelector('.cards__block');


for(let item of headerMenu){
    let menuItem = document.createElement('li');
    menuItem.className = "menu__items";
    if(item.dropdown){
        let dropdownContent = document.createElement('div');
        dropdownContent.className = "dropdown-content";
        for(let links of item.dropdown){
            let link = document.createElement('a');
            link.href = links.href;
            link.innerHTML = links.text;
            dropdownContent.append(link);
        }

        let dropdownButton = document.createElement('div');
        dropdownButton.className = 'dropdown';
        dropdownButton.innerHTML = `
            <span class="dropbtn">${item.title}</span>
            <div class="arrow">
                <div class="nav-arrow"></div>
            </div>
        `;

        menuItem.append(dropdownButton);
        menuItem.append(dropdownContent);
    } else{
        menuItem.innerHTML = `<a href="${item.href}">${item.title}</a>`
    }
    headerBlock.append(menuItem);
}

for(let item of projects){
    let link = document.createElement('a');
    link.className = "card__link";
    link.href = item.href;

    let project = document.createElement('div');
    project.className = "card";

    let image = document.createElement('img');
    image.className = "card__image";
    image.src = item.imageSrc;
    project.append(image);

    let textBlock = document.createElement('div');
    textBlock.className = "text";
    project.append(textBlock);

    let title = document.createElement('h2');
    title.className = "card__title";
    title.innerHTML = item.title;
    textBlock.append(title);

    let description = document.createElement('p');
    description.className = "card__description";
    description.innerHTML = item.description;
    textBlock.append(description);

    link.append(project)

    projectBlock.append(link);
}


for(let elem of document.querySelectorAll('.dropdown')){
    let menuItem = elem.closest(".menu__items");
    elem.addEventListener("click", function(e) {
        if(window.screen.width <= 900)  {
            // console.log(e);
            if(!menuItem.classList.contains("active")){
                for(let elements of document.querySelectorAll('.menu__items.active')){
                    let dropdownContent = elements.querySelector(".dropdown-content");
                    elements.classList.remove('active');
                    dropdownContent.style.maxHeight = null;
                }
            }
            menuItem.classList.toggle('active')
            let dropdownContent = menuItem.querySelector(".dropdown-content");
            if (dropdownContent.style.maxHeight) {
                dropdownContent.style.maxHeight = null;
              } else {
                dropdownContent.style.maxHeight = dropdownContent.scrollHeight + "px";
              } 
        }
    })
    elem.removeEventListener("click", function(e) {
        if(window.screen.width <= 900)  menuItem.classList.toggle('active')
    })
}

for(let elem of document.querySelectorAll('.controller')){
    const burgerMenu = document.querySelector(".menu__list");
    const xMark = document.querySelector(".x-mark")
    elem.addEventListener("click", function(e) {
        burgerMenu.classList.toggle('active')
        xMark.classList.toggle('active')
        document.body.classList.toggle('lock');
    });
    elem.removeEventListener("click", function(e) {
        burgerMenu.classList.toggle('active')
        xMark.classList.toggle('active')
        document.body.classList.toggle('lock');
    });
}

let timer;

const input = document.querySelector('#search');
input.addEventListener('keyup', (e) => {
    const text = e.currentTarget.value;

    clearTimeout(timer);

    timer = setTimeout(() => {
        projectSearch(text);
    }, 300);
});

function projectSearch(text){
    let empty = document.querySelector(".search__result");
    text = text.toLowerCase().trim();
    let cardText = document.querySelectorAll('.card > .text');
    if(text != ''){
        cardText.forEach(function(element){
            let cardProject = element.closest(".card__link");
            let title = element.querySelector(".card__title").innerHTML.toLowerCase();
            let description = element.querySelector(".card__description").innerHTML.toLowerCase();
                if(title.search(text) === -1 && description.search(text) === -1){
                    cardProject.classList.add("hide");
                }
                else{
                    cardProject.classList.remove("hide");
                    empty.classList.add("hidden");
                }
        })
        let hidenProjects = document.querySelectorAll(".hide");
        if(cardText.length === hidenProjects.length) {
            empty.classList.remove('hidden');
        }
    }
    else{
        empty.classList.add("hidden");
        cardText.forEach(function(element){
            let cardProject = element.closest(".card__link");
                cardProject.classList.remove("hide");
        })
    }
}